let User,jwt;_ed5‍.x([["getPublicKey",()=>getPublicKey],["logout",()=>logout],["uploadUserInfo",()=>uploadUserInfo]]);_ed5‍.w("../models/user",[["default",["User"],function(v){User=v}]]);_ed5‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);


const JWT_SECRET = "HJKKHNGBJUNDU728LLAD82NNQP123JDQLL";
       const getPublicKey = (req, res) => {
  try {
    const { wallet } = req.body;
    User.findOne({ public_key: wallet }).exec((err, user) => {
      if (user) {
        const token = jwt.sign({ _id: user._id }, JWT_SECRET);
        res.cookie("token", token, {
          httpOnly: true,
        });
        res.status(200).json({
          user: user,
          message: "Hello Welcome Back!",
        });
      } else {
        let newUser = new User({ public_key: wallet });
        newUser.save((err, success) => {
          if (err) {
            _ed5‍.g.console.log(err);
            return res.status(400).json({
              error: err,
            });
          }
          return res.json({
            message: "User Registered",
          });
        });
      }
    });
  } catch (error) {
    _ed5‍.g.console.log(error);
    return res.status(400).json({
      error: "Error Try Again",
    });
  }
};

       const logout = async (res, req) => {
  try {
    res.clearCookie("token");
    res.status(200).json({
      message: "Logged Out Successfully",
    });
  } catch (error) {
    _ed5‍.g.console.log(error);
  }
};

       const uploadUserInfo = async (req, res) => {
  //  const userId = req.params.id;
  const { name, email, age, phone, gender, aadhar } = req.body;

  User.findOne({ _id: req.body._id }, (err, user) => {
    if (err || !user) {
      return res.status(400).json({
        error: "User not found",
      });
    }
    user.name = name;
    user.email = email;
    user.age = age;
    user.phone = phone;
    user.gender = gender;
    user.aadhar = aadhar;

    user.save((err, updatedUser) => {
      if (err) {
        _ed5‍.g.console.log("USER UPDATE ERROR", err);
        return res.status(400).json({
          error: "User update failed",
        });
      }
      return res.status(200).json({
        message: "User Details Uploaded",
      });
    });
  });
};
